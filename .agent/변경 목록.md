# 📝 변경 목록

이 문서는 프로필 필드 제거 작업에 대한 변경사항을 정리한 것입니다.

**작업 일자**: 2026-01-13  
**작업 내용**: `nickname`, `profile_image_url`, `last_login_at` 필드 제거

---

## 📋 목차

1. [변경 요약](#변경-요약)
2. [백엔드 변경사항](#백엔드-변경사항)
3. [프론트엔드 변경사항](#프론트엔드-변경사항)
4. [다른 개발자에게 알려야 할 사항](#다른-개발자에게-알려야-할-사항)
5. [API 응답 형식 변경](#api-응답-형식-변경)

---

## 변경 요약

### 제거된 필드
다음 3개의 필드가 **백엔드와 프론트엔드 모두에서 완전히 제거**되었습니다:
- `nickname` (닉네임)
- `profile_image_url` (프로필 이미지 URL)
- `last_login_at` (마지막 로그인 시간)

### 이유
이 필드들은 데이터베이스 스키마(`.agent/data.sql`)에 정의되어 있지 않았지만, 이전 코드에서는 API 응답에 포함되어 있었습니다. 실제 데이터베이스에 저장되지 않는 필드를 제거하여 코드와 데이터베이스 스키마를 일치시켰습니다.

---

## 백엔드 변경사항

### 1. 스키마 파일 (`backend/app/schemas/account.py`)

**파일 위치**: `backend/app/schemas/account.py`

**변경 내용**:
- `AccountBase` 클래스에서 다음 필드들을 제거했습니다:
  - `nickname: Optional[str]`
  - `profile_image_url: Optional[str]`
  - `last_login_at: Optional[datetime]`

**영향**:
- 이제 API 응답에 이 필드들이 포함되지 않습니다.
- 프론트엔드에서 이 필드들을 사용하려고 하면 에러가 발생할 수 있습니다.

**코드 예시 (변경 전)**:
```python
class AccountBase(BaseModel):
    account_id: int
    clerk_user_id: Optional[str]
    email: Optional[str]
    nickname: Optional[str]  # ❌ 제거됨
    profile_image_url: Optional[str]  # ❌ 제거됨
    last_login_at: Optional[datetime]  # ❌ 제거됨
    created_at: Optional[datetime]
    # ...
```

**코드 예시 (변경 후)**:
```python
class AccountBase(BaseModel):
    account_id: int
    clerk_user_id: Optional[str]
    email: Optional[str]
    created_at: Optional[datetime]
    # ... (nickname, profile_image_url, last_login_at 제거됨)
```

---

### 2. 인증 API 엔드포인트 (`backend/app/api/v1/endpoints/auth.py`)

**파일 위치**: `backend/app/api/v1/endpoints/auth.py`

#### 변경 사항 1: `get_my_profile` 함수

**변경 내용**:
- API 응답에서 `nickname`, `profile_image_url`, `last_login_at` 필드를 제거했습니다.
- API 문서(docstring)에서도 해당 필드 설명을 제거했습니다.

**영향**:
- `GET /api/v1/auth/me` 엔드포인트를 호출하면 이 필드들이 응답에 포함되지 않습니다.

#### 변경 사항 2: `update_my_profile` 함수

**변경 내용**:
- API 문서에서 "수정 가능한 필드" 섹션 제거 (nickname, profile_image_url 관련)
- 예제 응답에서 해당 필드 제거

**영향**:
- `PATCH /api/v1/auth/me` 엔드포인트의 API 문서가 업데이트되었습니다.
- 실제로는 이전에도 이 필드들을 수정할 수 없었지만, 문서에서 명시되어 있었던 부분을 정리했습니다.

---

### 3. 관리자 API 엔드포인트 (`backend/app/api/v1/endpoints/admin.py`)

**파일 위치**: `backend/app/api/v1/endpoints/admin.py`

#### 변경 사항 1: `get_all_accounts` 함수

**변경 내용**:
- 계정 목록 응답에서 `nickname`, `profile_image_url`, `last_login_at` 필드를 제거했습니다.

**영향**:
- `GET /api/v1/admin/accounts` 엔드포인트 응답 형식이 변경되었습니다.

#### 변경 사항 2: `get_account_by_id` 함수

**변경 내용**:
- 특정 계정 조회 응답에서 해당 필드들을 제거했습니다.

**영향**:
- `GET /api/v1/admin/accounts/{account_id}` 엔드포인트 응답 형식이 변경되었습니다.

#### 변경 사항 3: `hard_delete_account` 함수

**변경 내용**:
- 삭제 성공 메시지에서 닉네임 참조를 제거했습니다.

**코드 예시 (변경 전)**:
```python
return {
    "message": f"계정 '{account.nickname}' (ID: {account_id})이(가) 영구적으로 삭제되었습니다."
}
```

**코드 예시 (변경 후)**:
```python
return {
    "message": f"계정 (ID: {account_id})이(가) 영구적으로 삭제되었습니다."
}
```

---

### 4. 메인 파일 (`backend/app/main.py`)

**파일 위치**: `backend/app/main.py`

**변경 내용**:
- SQLAlchemy 모델 관계(relationship) 초기화를 위해 모든 모델을 import하도록 추가했습니다.

**코드 예시**:
```python
# SQLAlchemy 관계(relationship) 초기화를 위해 모든 모델 import
from app.models import (
    account,
    apartment,
    apart_detail,
    favorite,
    my_property,
    state,
    sale,
    rent,
    house_score,
)
```

**영향**:
- 이 변경은 SQLAlchemy가 모델 간의 관계를 올바르게 인식하도록 합니다.
- 다른 개발자가 새로운 모델을 추가할 때, `main.py`에 import를 추가해야 할 수 있습니다.

**⚠️ 중요**: 새로운 모델을 추가할 때는 반드시 `main.py`의 import 목록에 추가해야 합니다!

---

## 프론트엔드 변경사항

### 1. 프로필 훅 (`frontend/src/hooks/useProfile.ts`)

**파일 위치**: `frontend/src/hooks/useProfile.ts`

**변경 내용**:
- `Profile` 인터페이스에서 `nickname`, `profile_image_url`, `last_login_at` 필드 제거
- `UpdateProfileData` 인터페이스에서 `nickname`, `profile_image_url` 필드 제거

**영향**:
- 이 훅을 사용하는 컴포넌트에서 더 이상 이 필드들에 접근할 수 없습니다.

---

### 2. 프로필 화면 (`frontend/app/profile.tsx`)

**파일 위치**: `frontend/app/profile.tsx`

**변경 내용**:
- `UserProfile` 인터페이스에서 해당 필드 제거
- `nickname`, `profileImageUrl` state 변수 제거
- 프로필 수정 UI 섹션 전체 제거 (닉네임 입력, 프로필 이미지 URL 입력)
- 마지막 로그인 시간 표시 제거

**영향**:
- 프로필 화면에서 더 이상 닉네임이나 프로필 이미지를 수정할 수 없습니다.
- 마지막 로그인 시간이 표시되지 않습니다.

---

### 3. DB 뷰어 (`frontend/src/DbViewer.tsx`)

**파일 위치**: `frontend/src/DbViewer.tsx`

**변경 내용**:
- `Account` 인터페이스에서 해당 필드 제거
- 테이블에서 "닉네임", "마지막 로그인" 컬럼 제거
- 테이블의 `colSpan` 값을 7에서 5로 변경 (컬럼 개수 감소)

**영향**:
- DB 뷰어에서 계정 목록을 볼 때 닉네임과 마지막 로그인 시간이 표시되지 않습니다.

---

### 4. DB 화면 (`frontend/app/db.tsx`)

**파일 위치**: `frontend/app/db.tsx`

**변경 내용**:
- `Account` 인터페이스에서 해당 필드 제거
- UI에서 닉네임 표시를 이메일로 변경
- 마지막 로그인 시간 표시를 가입일 표시로 변경

**영향**:
- 모바일 DB 화면에서 계정 정보 표시 형식이 변경되었습니다.

---

## 다른 개발자에게 알려야 할 사항

### ⚠️ 중요 사항

1. **API 응답 형식 변경**
   - 모든 사용자 계정 관련 API 응답에서 `nickname`, `profile_image_url`, `last_login_at` 필드가 제거되었습니다.
   - 프론트엔드에서 이 필드들을 사용하는 코드가 있다면 반드시 제거해야 합니다.

2. **데이터베이스 스키마**
   - 이 필드들은 데이터베이스에 저장되지 않았으므로, 마이그레이션이나 데이터 손실 걱정은 없습니다.

3. **새로운 모델 추가 시 주의사항**
   - 새로운 SQLAlchemy 모델을 추가할 때는 `backend/app/main.py` 파일의 import 목록에 추가해야 합니다.
   - 이를 빠뜨리면 SQLAlchemy 관계 초기화 에러가 발생할 수 있습니다.

4. **프로필 수정 기능**
   - 더 이상 닉네임이나 프로필 이미지를 수정할 수 없습니다.
   - 사용자 정보는 Clerk에서 관리되며, 백엔드 DB에는 이메일과 기본 정보만 저장됩니다.

---

## API 응답 형식 변경

### 변경 전 응답 예시

```json
{
  "success": true,
  "data": {
    "account_id": 1,
    "clerk_user_id": "user_2abc123def456",
    "email": "user@example.com",
    "nickname": "홍길동",
    "profile_image_url": "https://example.com/profile.jpg",
    "last_login_at": "2026-01-11T12:00:00Z",
    "created_at": "2026-01-01T00:00:00Z",
    "updated_at": "2026-01-01T00:00:00Z",
    "is_deleted": false
  }
}
```

### 변경 후 응답 예시

```json
{
  "success": true,
  "data": {
    "account_id": 1,
    "clerk_user_id": "user_2abc123def456",
    "email": "user@example.com",
    "is_admin": null,
    "created_at": "2026-01-01T00:00:00Z",
    "updated_at": "2026-01-01T00:00:00Z",
    "is_deleted": false
  }
}
```

**변경된 엔드포인트**:
- `GET /api/v1/auth/me` - 내 프로필 조회
- `PATCH /api/v1/auth/me` - 내 프로필 수정
- `GET /api/v1/admin/accounts` - 계정 목록 조회
- `GET /api/v1/admin/accounts/{account_id}` - 특정 계정 조회

---

## 📚 관련 파일 목록

### 백엔드
- `backend/app/schemas/account.py` - 스키마 정의
- `backend/app/api/v1/endpoints/auth.py` - 인증 API
- `backend/app/api/v1/endpoints/admin.py` - 관리자 API
- `backend/app/main.py` - 모델 import 추가

### 프론트엔드
- `frontend/src/hooks/useProfile.ts` - 프로필 훅
- `frontend/app/profile.tsx` - 프로필 화면
- `frontend/src/DbViewer.tsx` - DB 뷰어 (웹)
- `frontend/app/db.tsx` - DB 화면 (모바일)

---

## ❓ FAQ

### Q1: 왜 이 필드들을 제거했나요?
**A**: 데이터베이스 스키마(`.agent/data.sql`)에 이 필드들이 정의되어 있지 않기 때문입니다. 실제로 저장되지 않는 데이터를 API 응답에 포함하는 것은 혼란을 야기할 수 있습니다.

### Q2: 기존 데이터는 어떻게 되나요?
**A**: 이 필드들은 데이터베이스에 저장되지 않았으므로 데이터 손실 걱정은 없습니다.

### Q3: 나중에 다시 추가하고 싶으면 어떻게 하나요?
**A**: 
1. 먼저 데이터베이스 스키마(`.agent/data.sql`)에 필드를 추가해야 합니다.
2. SQLAlchemy 모델(`backend/app/models/account.py`)에 필드를 추가합니다.
3. Pydantic 스키마(`backend/app/schemas/account.py`)에 필드를 추가합니다.
4. 프론트엔드 인터페이스와 UI를 업데이트합니다.

### Q4: 다른 API도 영향을 받나요?
**A**: 사용자 계정 정보를 반환하는 모든 API에 영향을 미칩니다. 위에 나열한 엔드포인트 목록을 참고하세요.

---

**마지막 업데이트**: 2026-01-13  
**작성자**: AI Assistant
