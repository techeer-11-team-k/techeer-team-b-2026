# ============================================================
# ğŸ  ë¶€ë™ì‚° ë¶„ì„ í”Œë«í¼ - Frontend Production Dockerfile
# ============================================================
# ë¹Œë“œ: docker build -f Dockerfile.prod -t realestate-frontend-prod .
# ì‹¤í–‰: docker run -p 4000:4000 realestate-frontend-prod
# ============================================================

# Stage 1: ë¹Œë“œ
FROM node:20-alpine AS builder

WORKDIR /app

# package.jsonê³¼ package-lock.json ë¨¼ì € ë³µì‚¬ (ìºì‹± ìµœì í™”)
COPY package*.json ./

# ì˜ì¡´ì„± ì„¤ì¹˜
RUN npm ci --no-audit --no-fund

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ë¹Œë“œ ì‹œì ì— í•„ìš”)
ARG VITE_API_BASE_URL
ARG VITE_CLERK_PUBLISHABLE_KEY
ARG VITE_KAKAO_JAVASCRIPT_KEY

ENV VITE_API_BASE_URL=$VITE_API_BASE_URL
ENV VITE_CLERK_PUBLISHABLE_KEY=$VITE_CLERK_PUBLISHABLE_KEY
ENV VITE_KAKAO_JAVASCRIPT_KEY=$VITE_KAKAO_JAVASCRIPT_KEY

# í”„ë¡œë•ì…˜ ë¹Œë“œ
RUN npm run build

# Stage 2: í”„ë¡œë•ì…˜ ì„œë²„
FROM node:20-alpine AS runner

WORKDIR /app

# serve íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN npm install -g serve

# ë¹Œë“œ ê²°ê³¼ë¬¼ë§Œ ë³µì‚¬
COPY --from=builder /app/build ./build

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 4000

# í”„ë¡œë•ì…˜ ì„œë²„ ì‹¤í–‰
CMD ["serve", "-s", "build", "-l", "4000"]
