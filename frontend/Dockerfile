# ============================================================
# ğŸ  ë¶€ë™ì‚° ë¶„ì„ í”Œë«í¼ - Frontend Dockerfile
# ============================================================
# ë¹Œë“œ: docker build -t realestate-frontend .
# ì‹¤í–‰: docker run -p 3000:3000 realestate-frontend
# ============================================================

# Node.js 20 LTS ì´ë¯¸ì§€ ì‚¬ìš©
FROM node:20-alpine

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
ENV NODE_ENV=development \
    VITE_API_BASE_URL=http://localhost:8000/api/v1

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# package.jsonê³¼ package-lock.json ë¨¼ì € ë³µì‚¬ (ìºì‹± ìµœì í™”)
COPY package*.json ./

# ì˜ì¡´ì„± ì„¤ì¹˜ (highcharts, highcharts-react-official í¬í•¨)
# npm ciê°€ ì‹¤íŒ¨í•˜ë©´ npm installë¡œ í´ë°±
RUN npm ci --no-audit --no-fund || (npm install --no-audit --no-fund && npm cache clean --force)

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# ê°œë°œ ëª¨ë“œì—ì„œë„ ì˜ì¡´ì„± ì¬í™•ì¸ (ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì‹œ node_modules ë™ê¸°í™” ë³´ì¥)
# highcharts, highcharts-react-official ë“± ìƒˆë¡œ ì¶”ê°€ëœ íŒ¨í‚¤ì§€ê°€ í™•ì‹¤íˆ ì„¤ì¹˜ë˜ë„ë¡ í•¨
RUN npm install --no-audit --no-fund || true

# Entrypoint ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ ë° ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 3000

# Entrypointë¥¼ í†µí•´ ì˜ì¡´ì„± í™•ì¸ í›„ ê°œë°œ ì„œë²„ ì‹¤í–‰
ENTRYPOINT ["/docker-entrypoint.sh"]
