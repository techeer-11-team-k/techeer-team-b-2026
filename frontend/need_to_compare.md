# 비교 기능 프론트엔드-백엔드 연동 요구사항

## 문서 메타
| 항목 | 내용 |
|------|------|
| 문서 제목 | 비교 기능 API 연동 요구사항 |
| 작성일 | 2026-01-21 |
| 버전 | 1.0.0 |
| 문서 타입 | 기술명세서 (Tech Spec) |
| 대상 독자 | 백엔드 개발자, 프론트엔드 개발자 |

---

## 한 줄 요약
아파트 비교 기능을 위해 **다중 아파트 조회**, **평형별 가격 정보**, **학교 정보** API가 필요함.

---

## 배경 & 문제 정의

### 현재 상태
- 프론트엔드에서 아파트 비교 기능 UI 구현 완료
- 현재 하드코딩된 Mock 데이터 사용 중
- 백엔드 API 연동 필요

### 문제점
1. 비교를 위한 다중 아파트 동시 조회 API 부재
2. 평형(전용면적)별 가격 정보 조회 API 부재
3. 아파트 주변 학교 정보 API 부재

---

## 목표 / 비목표

### 목표
- [ ] 아파트 비교 기능의 백엔드 API 연동
- [ ] 실시간 데이터 기반 비교 분석 제공
- [ ] 사용자 맞춤 비교 목록 관리

### 비목표
- 비교 결과 공유 기능 (추후 개발)
- 비교 결과 PDF 다운로드 (추후 개발)

---

## 범위 (Scope)

### In Scope
- 아파트 검색 및 선택
- 1:1 비교 및 다수 비교 (최대 8개)
- 평형별 가격 비교
- 주변 학교 정보 표시

### Out of Scope
- AI 기반 비교 추천
- 비교 히스토리 저장

---

## 요구사항

### 기능 요구사항 (FR)

#### FR-01: 다중 아파트 조회 API
| 항목 | 내용 |
|------|------|
| 설명 | 여러 아파트를 한 번에 조회하여 비교 데이터 반환 |
| 입력 | 아파트 ID 배열 (최대 8개) |
| 출력 | 아파트별 상세 정보 + 비교용 통계 |
| 우선순위 | 🔴 필수 |

**필요 데이터**:
```
- 아파트 기본 정보 (이름, 주소, 지역)
- 가격 정보 (매매가, 전세가, 전세가율)
- 평당가
- 세대수
- 주차공간 (세대당)
- 건축연도
- 지하철역 (노선, 역명, 도보시간)
```

#### FR-02: 평형별 가격 조회 API
| 항목 | 내용 |
|------|------|
| 설명 | 특정 아파트의 평형(전용면적)별 가격 정보 조회 |
| 입력 | 아파트 ID |
| 출력 | 평형 목록 + 각 평형별 가격 정보 |
| 우선순위 | 🔴 필수 |

**필요 데이터**:
```
- 평형 타입 (예: "24평형", "32평형")
- 전용면적 (m²)
- 최근 매매가
- 최근 전세가
- 평당가
- 전세가율
```

#### FR-03: 주변 학교 정보 API
| 항목 | 내용 |
|------|------|
| 설명 | 아파트 주변 학교 목록 조회 |
| 입력 | 아파트 ID |
| 출력 | 초/중/고등학교 목록 |
| 우선순위 | 🟡 선택 |

**필요 데이터**:
```
- 학교명
- 학교 유형 (초등학교/중학교/고등학교)
- 거리 (도보시간) - 선택사항
```

#### FR-04: 아파트 검색 API (기존 활용)
| 항목 | 내용 |
|------|------|
| 설명 | 아파트명/지역으로 검색 |
| 엔드포인트 | `GET /api/v1/search/apartments` (기존) |
| 우선순위 | ✅ 기존 API 활용 |

### 비기능 요구사항 (NFR)

| ID | 요구사항 | 기준 |
|----|----------|------|
| NFR-01 | 응답 속도 | 다중 아파트 조회 < 1초 |
| NFR-02 | 캐싱 | 비교 데이터 5분 캐시 |
| NFR-03 | 페이지네이션 | 검색 결과 최대 20개/페이지 |

---

## 용어/정의 (Glossary)

| 용어 | 정의 |
|------|------|
| 평형 | 전용면적을 평으로 환산한 값 (1평 ≈ 3.3058m²) |
| 평당가 | 매매가 / 평수 |
| 전세가율 | (전세가 / 매매가) × 100 |
| 도보시간 | 성인 기준 분 단위 (80m/분) |

---

## API/인터페이스 설계 (제안)

### API-01: 다중 아파트 비교 조회
```
POST /api/v1/apartments/compare
```

**Request Body**:
```json
{
  "apartment_ids": [1, 2, 3, 4, 5]
}
```

**Response**:
```json
{
  "apartments": [
    {
      "id": 1,
      "name": "압구정 현대",
      "region": "강남구",
      "address": "서울시 강남구 압구정동",
      "price": 45.0,
      "jeonse": 17.0,
      "jeonse_rate": 37.8,
      "price_per_pyeong": 1.32,
      "households": 2456,
      "parking_per_household": 1.5,
      "build_year": 2001,
      "nearest_subway": {
        "line": "3호선",
        "station": "압구정역",
        "walking_time": 8
      }
    }
  ]
}
```

### API-02: 평형별 가격 조회
```
GET /api/v1/apartments/{apt_id}/pyeong-prices
```

**Response**:
```json
{
  "apartment_id": 1,
  "apartment_name": "압구정 현대",
  "pyeong_options": [
    {
      "pyeong_type": "24평형",
      "area_m2": 84.0,
      "recent_price": 28.0,
      "recent_jeonse": 13.0,
      "price_per_pyeong": 1.17,
      "jeonse_rate": 46.4
    },
    {
      "pyeong_type": "32평형",
      "area_m2": 106.0,
      "recent_price": 35.0,
      "recent_jeonse": 16.0,
      "price_per_pyeong": 1.09,
      "jeonse_rate": 45.7
    }
  ]
}
```

### API-03: 주변 학교 조회
```
GET /api/v1/apartments/{apt_id}/nearby-schools
```

**Response**:
```json
{
  "apartment_id": 1,
  "schools": {
    "elementary": [
      { "name": "반포초등학교", "distance_m": 400 }
    ],
    "middle": [
      { "name": "반포중학교", "distance_m": 800 }
    ],
    "high": [
      { "name": "서초고등학교", "distance_m": 1200 }
    ]
  }
}
```

---

## 데이터 모델 매핑

### 기존 테이블 활용
| 프론트엔드 필드 | 백엔드 테이블.필드 | 비고 |
|----------------|-------------------|------|
| name | apartments.name | ✅ |
| region | apartments.region → states | ✅ |
| price | sales.price (최근 거래) | ✅ |
| jeonse | rents.deposit (최근 거래) | ✅ |
| households | apart_details.total_household_cnt | ✅ |
| build_year | apart_details.use_approval_date | ✅ |
| parking_spaces | apart_details.total_parking_cnt | ✅ |
| subway_line | apart_details.subway_line | ✅ |
| subway_station | apart_details.subway_station | ✅ |
| subway_time | apart_details.subway_time | ✅ |
| schools | apart_details.educationFacility | ✅ (파싱 필요) |

### 신규 테이블 필요 여부
| 데이터 | 상태 | 비고 |
|--------|------|------|
| 지하철역 정보 | ✅ 존재 | apart_details에 포함됨 |
| 학교 정보 | ✅ 존재 | educationFacility 필드에 텍스트로 저장됨 |

---

## 기존 API 활용 가능 항목

### 활용 가능
| 기능 | 기존 API | 활용도 |
|------|----------|--------|
| 아파트 검색 | `GET /api/v1/search/apartments` | ✅ 그대로 사용 |
| 아파트 상세 | `GET /api/v1/apartments/{id}/detail` | ⚠️ 일부 활용 |
| 유사 아파트 | `GET /api/v1/apartments/{id}/similar` | ⚠️ 참고용 |
| 가격 추이 | `GET /api/v1/apartments/{id}/price-trend` | ⚠️ 추후 확장 |

### 신규 개발 필요
| 기능 | 제안 API | 우선순위 |
|------|----------|----------|
| 다중 아파트 비교 | `POST /api/v1/apartments/compare` | 🔴 필수 |
| 평형별 가격 | `GET /api/v1/apartments/{id}/pyeong-prices` | 🔴 필수 |
| 주변 학교 | `GET /api/v1/apartments/{id}/nearby-schools` | 🟡 선택 |

---

## 테스트 플랜

| ID | 시나리오 | 입력 | 기대 결과 |
|----|----------|------|-----------|
| TC-01 | 단일 아파트 조회 | apt_ids: [1] | 1개 아파트 데이터 반환 |
| TC-02 | 다중 아파트 조회 | apt_ids: [1,2,3,4,5] | 5개 아파트 데이터 반환 |
| TC-03 | 최대 개수 조회 | apt_ids: 8개 | 8개 아파트 데이터 반환 |
| TC-04 | 초과 개수 조회 | apt_ids: 9개 | 400 에러 반환 |
| TC-05 | 없는 아파트 조회 | apt_ids: [99999] | 404 에러 또는 빈 배열 |
| TC-06 | 평형별 가격 조회 | apt_id: 1 | 평형 목록 반환 |
| TC-07 | 학교 정보 조회 | apt_id: 1 | 초/중/고 학교 목록 |

---

## 오픈 이슈 & 리스크

| ID | 이슈 | 영향 | 담당 | 상태 |
|----|------|------|------|------|
| ~~ISS-01~~ | ~~지하철역 거리 데이터 존재 여부~~ | ~~비교 기능 일부 제한~~ | 백엔드 | ✅ 해결됨 |
| ~~ISS-02~~ | ~~학교 데이터 소스~~ | ~~학교 비교 기능 불가~~ | 백엔드 | ✅ 해결됨 |
| ISS-03 | 학교 정보 파싱 로직 | educationFacility 텍스트 파싱 필요 | 프론트/백엔드 | ⬜ |
| ISS-04 | 평형별 가격 집계 로직 | 평형 선택 기능 제한 | 백엔드 | ⬜ |

---

## TODO

| 작업 | 담당 | 우선순위 | 상태 |
|------|------|----------|------|
| 지하철역 거리 데이터 확인 | 백엔드 | 높음 | ⬜ |
| 학교 데이터 소스 조사 | 백엔드 | 중간 | ⬜ |
| 다중 아파트 비교 API 개발 | 백엔드 | 높음 | ⬜ |
| 평형별 가격 API 개발 | 백엔드 | 높음 | ⬜ |
| 프론트엔드 API 연동 | 프론트엔드 | 높음 | ⬜ |
| 에러 핸들링 구현 | 프론트엔드 | 중간 | ⬜ |
| 로딩 상태 UI | 프론트엔드 | 중간 | ⬜ |

---

## 확인 질문

1. ~~**지하철역 거리 데이터**가 `apart_details` 테이블에 존재하는가?~~ → ✅ **확인됨**: `subway_line`, `subway_station`, `subway_time` 필드 존재

2. ~~**학교 데이터**는 어떻게 수집할 예정인가?~~ → ✅ **확인됨**: `educationFacility` 필드에 텍스트 형태로 저장됨 (예: "초등학교(괴정초등학교) 대학교(동주대학교)")

3. **학교 정보 파싱**을 어디서 처리할 것인가?
   - [ ] 백엔드에서 구조화된 JSON으로 변환하여 제공
   - [ ] 프론트엔드에서 텍스트 파싱
   
4. 평형별 가격은 **최근 거래 기준** 몇 개월까지 집계할 것인가?
   - [ ] 1개월
   - [ ] 3개월
   - [ ] 6개월
   - [ ] 12개월

4. 다중 아파트 비교 API 최대 개수는 **8개**로 적절한가? (예/아니오)

5. 비교 데이터 **캐시 TTL**은 5분으로 적절한가? (예/아니오)

---

## 참고 자료

- [백엔드 기능 문서](/.document/backend-features.md)
- 프론트엔드 컴포넌트: `components/views/Comparison.tsx`
